<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Chi Square Quantile-Quantile plots — cqplot â€¢ heplots</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">heplots</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Chi Square Quantile-Quantile plots</h1>
    </div>

    
    <p>A chi square quantile-quantile plots show the relationship between data-based 
values which should be distributed as \(\chi^2\) and corresponding quantiles
from the \(\chi^2\) distribution.  In multivariate analyses, this is often used both
to assess multivariate normality and check for outliers, using the
Mahalanobis squared distances (\(D^2\)) of observations from the centroid.

    <code>cqplot</code> is a more general version of similar functions 
in other packages that produce chi square QQ plots.
It allows for classical Mahalanobis squared distances
as well as robust estimates based on the MVE and MCD;
it provides an approximate confidence (concentration) envelope around the 
line of unit slope, a detrended version, where the reference line
is horizontal, the ability to identify or label unusual points,
and other graphical features.</p>
<p>The method for <code>"mlm"</code> objects applies this to the residuals from
the model.</p>
    

    <pre class="usage"><span class='fu'>cqplot</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for mlm</span>
<span class='fu'>cqplot</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>cqplot</span>(<span class='no'>x</span>, <span class='kw'>method</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"classical"</span>, <span class='st'>"mcd"</span>, <span class='st'>"mve"</span>),
        <span class='kw'>detrend</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>pch</span> <span class='kw'>=</span> <span class='fl'>19</span>, <span class='kw'>col</span> <span class='kw'>=</span> <span class='fu'>palette</span>()[<span class='fl'>1</span>], <span class='kw'>cex</span> <span class='kw'>=</span> <span class='fu'>par</span>(<span class='st'>"cex"</span>),
        <span class='kw'>ref.col</span> <span class='kw'>=</span> <span class='st'>"red"</span>, <span class='kw'>ref.lwd</span> <span class='kw'>=</span> <span class='fl'>2</span>,
        <span class='kw'>conf</span> <span class='kw'>=</span> <span class='fl'>0.95</span>, <span class='kw'>env.col</span> <span class='kw'>=</span> <span class='st'>"gray"</span>, <span class='kw'>env.lwd</span> <span class='kw'>=</span> <span class='fl'>2</span>, <span class='kw'>env.lty</span> <span class='kw'>=</span> <span class='fl'>1</span>,
        <span class='kw'>env.fill</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>, <span class='kw'>fill.alpha</span> <span class='kw'>=</span> <span class='fl'>0.2</span>,
        <span class='kw'>fill.color</span> <span class='kw'>=</span> <span class='fu'><a href='trans.colors.html'>trans.colors</a></span>(<span class='no'>ref.col</span>, <span class='no'>fill.alpha</span>),
        <span class='kw'>labels</span> <span class='kw'>=</span> <span class='kw'>if</span> (!<span class='fu'>is.null</span>(<span class='fu'>rownames</span>(<span class='no'>x</span>))) <span class='fu'>rownames</span>(<span class='no'>x</span>) <span class='kw'>else</span> <span class='fl'>1</span>:<span class='fu'>nrow</span>(<span class='no'>x</span>),
        <span class='no'>id.n</span>, <span class='kw'>id.method</span> <span class='kw'>=</span> <span class='st'>"y"</span>, <span class='kw'>id.cex</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>id.col</span> <span class='kw'>=</span> <span class='fu'>palette</span>()[<span class='fl'>1</span>],
        <span class='no'>xlab</span>, <span class='no'>ylab</span>, <span class='no'>main</span>, <span class='kw'>what</span><span class='kw'>=</span><span class='fu'>deparse</span>(<span class='fu'>substitute</span>(<span class='no'>x</span>)), <span class='no'>ylim</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>either a numeric data frame or matrix for the default method, or
  an object of class <code>"mlm"</code> representing a multivariate linear model.
  In the latter case, residuals from the model are plotted.</p></td>
    </tr>
    <tr>
      <th>&#8230;</th>
      <td><p>Other arguments passed to methods</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>estimation method used for center and covariance, one of:
<code>"classical"</code> (product-moment), 
<code>"mcd"</code> (minimum covariance determinant), or           
<code>"mve"</code> (minimum volume ellipsoid).</p></td>
    </tr>
    <tr>
      <th>detrend</th>
      <td><p>logical; if <code>FALSE</code>, the plot shows values of \(D^2\) vs. \(\chi^2\).
if <code>TRUE</code>, the ordinate shows values of \(D^2 - \chi^2\)</p></td>
    </tr>
    <tr>
      <th>pch</th>
      <td><p>plot symbol for points  Can be a vector of length equal to the number of rows in <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>col</th>
      <td><p>color for points; the default is the <em>first</em> entry in the current color palette 
(see <code><a href='http://www.rdocumentation.org/packages/grDevices/topics/palette'>palette</a></code> and <code><a href='http://www.rdocumentation.org/packages/graphics/topics/par'>par</a></code>.</p></td>
    </tr>
    <tr>
      <th>cex</th>
      <td><p>character symbol size for points.  Can be a vector of length equal to the number of rows in <code>x</code>.</p></td>
    </tr>
    <tr>
      <th>ref.col</th>
      <td><p>Color for the reference line</p></td>
    </tr>
    <tr>
      <th>ref.lwd</th>
      <td><p>Line width for the reference line</p></td>
    </tr>
    <tr>
      <th>conf</th>
      <td><p>confidence coverage for the approximate confidence envelope</p></td>
    </tr>
    <tr>
      <th>env.col</th>
      <td><p>line color for the boundary of the confidence envelope</p></td>
    </tr>
    <tr>
      <th>env.lwd</th>
      <td><p>line width for the confidence envelope</p></td>
    </tr>
    <tr>
      <th>env.lty</th>
      <td><p>line type for the confidence envelope</p></td>
    </tr>
    <tr>
      <th>env.fill</th>
      <td><p>logical; should the confidence envelope be filled?</p></td>
    </tr>
    <tr>
      <th>fill.alpha</th>
      <td><p>transparency value for <code>fill.color</code></p></td>
    </tr>
    <tr>
      <th>fill.color</th>
      <td><p>color used to fill the confidence envelope</p></td>
    </tr>
    <tr>
      <th>labels</th>
      <td><p>vector of text strings to be used to identify points, 
defaults to <code>rownames(x)</code> or observation numbers if <code>rownames(x)</code> is <code>NULL</code></p></td>
    </tr>
    <tr>
      <th>id.n</th>
      <td><p>number of points labeled. If <code>id.n=0</code>, the default, no point identification occurs.</p></td>
    </tr>
    <tr>
      <th>id.method</th>
      <td><p>point identification method. The default <code>id.method="y"</code> will identify the <code>id.n</code> points 
 	with the largest value of abs(y-mean(y)). See <code><a href='http://www.rdocumentation.org/packages/car/topics/showLabels'>showLabels</a></code> for other options.</p></td>
    </tr>
    <tr>
      <th>id.cex</th>
      <td><p>size of text for point labels</p></td>
    </tr>
    <tr>
      <th>id.col</th>
      <td><p>color for point labels</p></td>
    </tr>
    <tr>
      <th>xlab</th>
      <td><p>label for horizontal (theoretical quantiles) axis</p></td>
    </tr>
    <tr>
      <th>ylab</th>
      <td><p>label for vertical (empirical quantiles) axis</p></td>
    </tr>
    <tr>
      <th>main</th>
      <td><p>plot title</p></td>
    </tr>
    <tr>
      <th>what</th>
      <td><p>the name of the object plotted; used in the construction of <code>main</code>
when that is not specified.</p></td>
    </tr>
    <tr>
      <th>ylim</th>
      <td><p>limits for vertical axis.  If not specified, the range of the 
confidence envelope is used.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The calculation of the confidence envelope follows that used
in the SAS program, <a href='http://www.datavis.ca/sasmac/cqplot.html'>http://www.datavis.ca/sasmac/cqplot.html</a>
which comes from Chambers etal. (1983), Section 6.8.</p>
<p>The essential formula is
$$
SE ( z_{(i)} ) = \frac{\hat{\delta}}{g ( q_i )) \times
              \sqrt{ frac{ p_i (1-p_i} }{n}}
$$
where \(z_{(i)}\) is the i-th order value of \(D^2\),
\(\hat{\delta}\) is an estimate of the slope of the reference
line obtained from the corresponding quartiles
and \(g(q_i)\) is the density of the chi square distribution
at the quantile \(q_i\).</p>
<p>Note that this confidence envelope applies only to the \(D^2\)
computed using the classical estimates of location and scatter.
The <code><a href='http://www.rdocumentation.org/packages/car/topics/qqPlot'>car::qqPlot()</a></code> function provides for simulated envelopes,
but only for a univariate measure.
Oldford (2016) provides a general theory and methods for
QQ plots.</p>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>Returns invisibly the
vector of squared Mahalanobis distances corresponding to the rows of <code>x</code>
or the residuals of the model.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>J. Chambers, W. S. Cleveland, B. Kleiner, P. A. Tukey (1983).
 <em>Graphical methods for data analysis</em>, Wadsworth.</p>
<p>R. W. Oldford (2016), "Self calibrating quantile-quantile plots", <em>The American Statistician</em>, 70, 74-90.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='Mahalanobis.html'>Mahalanobis</a></code> for calculation of Mahalanobis squared distance;
    <code><a href='http://www.rdocumentation.org/packages/stats/topics/qqnorm'>qqplot</a></code>; 
<code><a href='http://www.rdocumentation.org/packages/car/topics/qqPlot'>qqPlot</a></code> can give a similar result for Mahalanobis squared distances
of data or residuals;
<code><a href='http://www.rdocumentation.org/packages/qqtest/topics/qqtest'>qqtest</a></code> has many features for all types of QQ plots.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>cqplot</span>(<span class='no'>iris</span>[, <span class='fl'>1</span>:<span class='fl'>4</span>])</div><div class='img'><img src='cqplot-12.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='no'>iris.mod</span> <span class='kw'>&lt;-</span> <span class='fu'>lm</span>(<span class='fu'>as.matrix</span>(<span class='no'>iris</span>[,<span class='fl'>1</span>:<span class='fl'>4</span>]) ~ <span class='no'>Species</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>iris</span>)
<span class='fu'>cqplot</span>(<span class='no'>iris.mod</span>, <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>3</span>)</div><div class='img'><img src='cqplot-13.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># compare with car::qqPlot</span>
<span class='kw pkg'>car</span><span class='kw ns'>::</span><span class='fu'><a href='http://www.rdocumentation.org/packages/car/topics/qqPlot'>qqPlot</a></span>(<span class='fu'><a href='Mahalanobis.html'>Mahalanobis</a></span>(<span class='no'>iris</span>[, <span class='fl'>1</span>:<span class='fl'>4</span>]), <span class='kw'>dist</span><span class='kw'>=</span><span class='st'>"chisq"</span>, <span class='kw'>df</span><span class='kw'>=</span><span class='fl'>4</span>, <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>3</span>)</div><div class='img'><img src='cqplot-14.png' alt='' width='700' height='432.632880098887' /></div><div class='output co'>#&gt; 132 135 118 
#&gt; 150 149 148 </div><div class='input'>

<span class='co'># Adopted data</span>
<span class='no'>Adopted.mod</span> <span class='kw'>&lt;-</span> <span class='fu'>lm</span>(<span class='fu'>cbind</span>(<span class='no'>Age2IQ</span>, <span class='no'>Age4IQ</span>, <span class='no'>Age8IQ</span>, <span class='no'>Age13IQ</span>) ~ <span class='no'>AMED</span> + <span class='no'>BMIQ</span>,
                  <span class='kw'>data</span><span class='kw'>=</span><span class='no'>Adopted</span>)
<span class='fu'>cqplot</span>(<span class='no'>Adopted.mod</span>, <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>3</span>)</div><div class='img'><img src='cqplot-15.png' alt='' width='700' height='432.632880098887' /></div><div class='input'><span class='fu'>cqplot</span>(<span class='no'>Adopted.mod</span>, <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>3</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"mve"</span>)</div><div class='img'><img src='cqplot-16.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>

<span class='co'># Sake data</span>
<span class='no'>Sake.mod</span> <span class='kw'>&lt;-</span> <span class='fu'>lm</span>(<span class='fu'>cbind</span>(<span class='no'>taste</span>, <span class='no'>smell</span>) ~ <span class='no'>.</span>, <span class='kw'>data</span><span class='kw'>=</span><span class='no'>Sake</span>)
<span class='fu'>cqplot</span>(<span class='no'>Sake.mod</span>)</div><div class='img'><img src='cqplot-17.png' alt='' width='700' height='432.632880098887' /></div><div class='input'><span class='fu'>cqplot</span>(<span class='no'>Sake.mod</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"mve"</span>, <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>2</span>)</div><div class='img'><img src='cqplot-18.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># SocialCog data -- one extreme outlier</span>
<span class='fu'>data</span>(<span class='no'>SocialCog</span>)
<span class='no'>SC.mlm</span> <span class='kw'>&lt;-</span>  <span class='fu'>lm</span>(<span class='fu'>cbind</span>(<span class='no'>MgeEmotions</span>,<span class='no'>ToM</span>, <span class='no'>ExtBias</span>, <span class='no'>PersBias</span>) ~ <span class='no'>Dx</span>,
               <span class='kw'>data</span><span class='kw'>=</span><span class='no'>SocialCog</span>)
<span class='fu'>cqplot</span>(<span class='no'>SC.mlm</span>, <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>1</span>)</div><div class='img'><img src='cqplot-19.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>
<span class='co'># data frame example: stackloss data</span>
<span class='fu'>data</span>(<span class='no'>stackloss</span>)
<span class='fu'>cqplot</span>(<span class='no'>stackloss</span>[, <span class='fl'>1</span>:<span class='fl'>3</span>], <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>4</span>)                <span class='co'># very strange</span></div><div class='img'><img src='cqplot-20.png' alt='' width='700' height='432.632880098887' /></div><div class='input'><span class='fu'>cqplot</span>(<span class='no'>stackloss</span>[, <span class='fl'>1</span>:<span class='fl'>3</span>], <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>4</span>, <span class='kw'>detrend</span><span class='kw'>=</span><span class='fl'>TRUE</span>)</div><div class='img'><img src='cqplot-21.png' alt='' width='700' height='432.632880098887' /></div><div class='input'><span class='fu'>cqplot</span>(<span class='no'>stackloss</span>[, <span class='fl'>1</span>:<span class='fl'>3</span>], <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>4</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"mve"</span>)</div><div class='input'><span class='fu'>cqplot</span>(<span class='no'>stackloss</span>[, <span class='fl'>1</span>:<span class='fl'>3</span>], <span class='kw'>id.n</span><span class='kw'>=</span><span class='fl'>4</span>, <span class='kw'>method</span><span class='kw'>=</span><span class='st'>"mcd"</span>)</div><div class='img'><img src='cqplot-22.png' alt='' width='700' height='432.632880098887' /></div><div class='input'>

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>

      <li><a href="#value">Value</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Michael Friendly

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by John Fox, Michael Friendly.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
